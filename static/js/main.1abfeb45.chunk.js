(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{44:function(e,t,n){e.exports=n(59)},49:function(e,t,n){},50:function(e,t,n){},59:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(17),c=n.n(r),s=(n(49),n(50),n(27)),l=n(5),i=n(10),u=n(11),d=n(14),m=n(13),p=n(34),h=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement("h1",null,"Welcome to All Tunes!"),o.a.createElement("p",null,"Log in to Spotify to get started."),o.a.createElement(p.a,{href:"https://all-tunes-server.herokuapp.com/login",variant:"outline-success"},"Get started")," ")}}]),n}(a.Component),E=n(19),g=n(65),f=n(61),y=n(35),k=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).state={value:""},e.onHostButtonClicked=function(){e.sendHostPartyMessage()},e.sendHostPartyMessage=function(){try{e.props.socket.send(JSON.stringify({messageType:"CREATE_PARTY"}))}catch(t){console.log(t)}},e.onJoinButtonClicked=function(t){t.preventDefault(),console.log("Join button clicked"),e.sendJoinPartyMessage()},e.sendJoinPartyMessage=function(){var t={messageType:"JOIN_PARTY_REQUEST",partyCode:e.state.value.toUpperCase()};try{e.props.socket.send(JSON.stringify(t))}catch(n){console.log(n)}},e.handleChange=function(t){e.setState({value:t.target.value})},e}return Object(u.a)(n,[{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement(g.a,{onSubmit:this.onJoinButtonClicked},o.a.createElement(g.a.Group,{as:f.a,controlId:""},o.a.createElement(g.a.Label,{column:!0,sm:"2"},"Host a party"),o.a.createElement(y.a,{sm:"10"},o.a.createElement(p.a,{onClick:this.onHostButtonClicked},"Host party"))),o.a.createElement(g.a.Group,{as:f.a,controlId:""},o.a.createElement(g.a.Label,{column:!0,sm:"2"},"Join a party"),o.a.createElement(y.a,{sm:"2"},o.a.createElement(g.a.Control,{type:"text",placeholder:"Party code",maxLength:"6",style:{textTransform:"uppercase"},required:!0,value:this.state.value,onChange:this.handleChange}),o.a.createElement(g.a.Control.Feedback,{type:"invalid"},"Please enter party code.")),o.a.createElement(y.a,{sm:"5"},o.a.createElement(p.a,{type:"submit"},"Join party")))))}}]),n}(a.Component),v=n(62),C=n(63),b=n(66),S=n(64),O=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).state={value:"+",disabled:!1},e.onQueueButtonClicked=function(t){e.sendQueueSong(t),e.setState({disabled:!0,value:"-"})},e.sendQueueSong=function(t){var n={messageType:"QUEUE_SONG",uri:t.uri};try{e.props.socket.send(JSON.stringify(n))}catch(a){console.log(a)}},e}return Object(u.a)(n,[{key:"render",value:function(){var e=this,t=this.state.disabled?"danger":"success";return o.a.createElement(p.a,{variant:t,onClick:function(){return e.onQueueButtonClicked(e.props.song)},disabled:this.state.disabled},this.state.value)}}]),n}(a.Component),T=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).onDisconnectClicked=function(){e.sendDisconnectMessage()},e.sendDisconnectMessage=function(){try{e.props.socket.send(JSON.stringify({messageType:"DISCONNECT"}))}catch(t){console.log(t)}},e.renderTable=function(t){var n=0;return t.map((function(t){n++;var a="";return t.artists.forEach((function(e){a+=e.name+", "})),o.a.createElement("tr",{key:n},o.a.createElement("td",null,t.name),o.a.createElement("td",null,a),o.a.createElement("td",null,t.popularity),o.a.createElement("td",null,o.a.createElement(O,{song:t,socket:e.props.socket})))}))},e.renderTabs=function(){var t=0;return e.props.recommended.map((function(n){return t++,o.a.createElement(v.a,{eventKey:n.genre,title:n.genre,key:t},o.a.createElement(C.a,{striped:!0,bordered:!0,hover:!0},o.a.createElement("thead",null,o.a.createElement("tr",null,o.a.createElement("th",null,"Song"),o.a.createElement("th",null,"Artist(s)"),o.a.createElement("th",null,"Popularity"),o.a.createElement("th",null,"Queue"))),o.a.createElement("tbody",null,e.renderTable(n.songs))))}))},e.renderRecommended=function(){return e.props.recommended.length>0?o.a.createElement(b.a,{eventKey:"1",fill:!0},e.renderTabs()):o.a.createElement("div",null,o.a.createElement(S.a,{animation:"border"}))},e}return Object(u.a)(n,[{key:"render",value:function(){var e=this.props.isHost?o.a.createElement("div",null,o.a.createElement("label",null,"You are host"),this.renderRecommended()):null;return o.a.createElement("div",null,o.a.createElement(p.a,{variant:"danger",onClick:this.onDisconnectClicked},"Disconnect"),o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("h1",null,"Party: ",this.props.partyCode),e)}}]),n}(a.Component),_=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(i.a)(this,n),(e=t.call(this)).reconnect=function(){console.log("Attempting to reconnect to socket in 5s..."),setTimeout((function(){e.connect()}),5e3)},e.connect=function(){if(e.state.loggedIn){var t=new WebSocket(e.state.socketURL);t.onerror=function(){n.setState({isConnected:!1,partyCode:"",isHost:!1,recommended:[]}),t.close(),e.reconnect()},t.onopen=function(){console.log("Connected to socket")},e.setState({socket:t});var n=Object(E.a)(e);t.onmessage=function(a){var o=JSON.parse(a.data);switch(console.log(o),o.messageType){case"SEND_ACCESS_TOKEN":n.sendAccessToken();break;case"FAILED_ACCESS_TOKEN":n.setState({isConnected:!1,partyCode:"",isHost:!1}),console.log("Sending access token failed \n"+o.error);var r=n.state;r.access_token&&r.refresh_token&&r.userId?n.sendAccessToken():window.location.replace("http://localhost:8888/login");break;case"CREATE_PARTY_SUCCESS":var c=o.partyCode;console.log("Hosting party: "+c),n.setState({partyCode:c,isHost:!0,isConnected:!0});break;case"JOINED_PARTY":var s=o.partyCode;console.log("Joined party: "+s),n.setState({partyCode:s,isConnected:!0});break;case"JOIN_PARTY_ERROR":n.setState({isConnected:!1,partyCode:"",isHost:!1}),console.log("Failed to join party \n"+o.error);break;case"UPDATE_RECOMMENDED":console.table(o.data),n.setState({recommended:o.data});break;case"DISCONNECT":console.log("Disconnected"),n.setState({isConnected:!1,partyCode:"",isHost:!1,recommended:[]});break;default:console.log("Recieved unknown message")}t.onclose=function(){n.setState({isConnected:!1,partyCode:"",isHost:!1,recommended:[]}),console.log("Socket closed"),e.reconnect()}}}},e.sendAccessToken=function(){var t={messageType:"ACCESS_TOKEN",id:e.state.userId,access_token:e.state.access_token,refresh_token:e.state.refresh_token};try{e.state.socket.send(JSON.stringify(t))}catch(n){console.log(n)}},e.getDollarParams=function(){var e,t={},n=/([^&;=]+)=?([^&;]*)/g,a=window.location.href.split("$")[1];for(e=n.exec(a);e;)t[e[1]]=decodeURIComponent(e[2]),e=n.exec(a);return t};var a=e.getDollarParams(),o=a.id,r=a.access_token,c=a.refresh_token;return e.state={loggedIn:!!r,socketURL:"wss://all-tunes-server.herokuapp.com/",socket:null,userId:o,access_token:r,refresh_token:c,isHost:!1,partyCode:"",isConnected:!1,recommended:[]},e}return Object(u.a)(n,[{key:"componentDidMount",value:function(){this.connect()}},{key:"render",value:function(){var e=this.state.loggedIn?null:o.a.createElement(l.a,{to:"/"}),t=this.state.isConnected?o.a.createElement(T,{isHost:this.state.isHost,partyCode:this.state.partyCode,recommended:this.state.recommended,socket:this.state.socket}):o.a.createElement(k,{socket:this.state.socket});return o.a.createElement("div",null,e,t)}}]),n}(a.Component);var j=function(){return o.a.createElement(s.a,{basename:"/"},o.a.createElement(l.b,{path:"/home"},o.a.createElement(_,null)),o.a.createElement(l.b,{exact:!0,path:"/"},o.a.createElement(h,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(58);c.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(j,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[44,1,2]]]);
//# sourceMappingURL=main.1abfeb45.chunk.js.map